---
title: "Machine Learning PGA MASTERS"
author: "Sam Milnes"
date: "3/27/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


DEFINING COLUMN NAMES:


Top10 -> How many top 10 finishes did the player have for that given year

Wins -> How many tour wins did the player have for that given year

Score Average -> The average score the player had for given year

Rounds -> How many rounds the player played that given year

Bounce Back -> Percent of holes that scored over par immediately followed by a hole that scored less than par

Driving Accuracy -> The percentage of time a tee shot comes to rest in the fairway (regardless of club)

Driving Distance -> The average number of yards per measured drive

Gir -> (Greens in regulation) The percent of time a player was able to hit the green in regulation (greens hit in regulation/holes played)

putts_round ->  The average number of total putts per round

scramble -> Percent that shows a players ability to make par (or better) even if a Green in Regulation (GIR) is missed

sg_putt -> The number of putts a player takes from a specific distance is measured against a statistical baseline to determine the player's strokes gained or lost on a hole.

sg_t2g -> The per round average of the number of Strokes the player was better or worse than the field average on the same course & event minus the Players Strokes Gained putting value.

sg_total -> The per round average of the number of Strokes the player was better or worse than the field average on the same course & event.

sg_approach -> The number of Approach the Green strokes a player takes from specific locations and distances are measured against a statistical baseline to determine the player's strokes gained or lost on a hole

sg_tee -> The number of strokes a player takes from a specific distance off the tee on Par 4 & par 5's is measured against a statistical baseline to determine the player's strokes gained or lost off the tee on a hole

sg_ar -> The number of Around the Green strokes a player takes from specific locations and distances are measured against a statistical baseline to determine the player's strokes gained or lost on a hole

par4_sa -> The average score on all par 4's played 

par3_sa -> The average score on all par 3's played 

par5_sa -> The average score on all par 5's played 

covered_tee -> For those par 4's and par 5's where the tee shot was determined by a laser, the percentage of the hole distances that are covered by the tee shot.

left_rough -> The percentage of time a tee shot comes to rest in the left rough (regardless of club)

right_rough -> The percentage of time a tee shot comes to rest in the right rough (regardless of club)

fair_bunk -> The percentage of time a tee shot comes to rest in a fairway bunker (regardless of club)

gir_fair -> The percent of time a player was able to hit the green in regulation when the tee shot came to rest on the fairway

gir_not_fair -> The percent of time a player was not able to hit the green in regulation when the tee shot came to rest on the fairway

prox_fair -> The average distance remaining to the hole for all approach shots hit from the fairway (or the tee box on a par 3)

prox_rough -> The average distance remaining to the hole for all approach shots hit from the rough, but not around the green. The approach shot must end on or around the green or in the hole.

go_for_green -> The percent of time a player attempting to go for the green is successful. A player is assumed to be going for the green if the first shot on a par 4 or second shot on a par 5 lands on or around the green. If the second shot on a par 5 lands in the water, it is included as well

sand_save -> The percent of time a player was able to get 'up and down' once in a greenside sand bunker (regardless of score)

prox_arg -> The average distance to the hole (in feet) after hitting the ball onto the putting surface from around the green.

putt_25 ->  the percent of putts made when the ball is greater than 25 feet from the hole

putt15_25 ->  the percent of putts made when the ball is between 15 and 25 feet from the hole

putt10_15 ->  the percent of putts made when the ball is between 10 and 15 feet from the hole

putt_10 -> the percent of putts made when the ball is less than 10 feet from the hole

finround_sa -> The average number of strokes for the final round of each tournament played.

masters_finish -> the place the player finished in at that years masters. CUT means player didn't make cut.

total_score -> The players total score from that year at the masters



List of players playing in 2022 Masters
```{r}

masters_list <- read.csv("2022MastersList.csv")

```

Filter data to only players playing in Masters this year.
```{r}
library(dplyr)    

current_masters <- filter(pga, player_name %in% masters2022_list)

current_masters <- current_masters[, -1]
#View(current_masters)

```

Filter data to see stats from 2005 - 2021
```{r}

current_masters_0518_stats <- current_masters[which(current_masters$year <= 2019),]
View(current_masters_0518_stats)

```


Things to do:
- Clean Data:
  - Clean score average column, fill in blanks with the median of all score         averages
  - Clean holes column, fill in blanks with median of all holes
  - clean gir_fair column, fill with median
  - Fill in putting averages
  
  
Cleaning Training Data
```{r}

pga <- read.csv("C:\\Users\\milness\\Desktop\\Machine Learning\\Final Project\\2022Masters_pred_data.csv")

# Get rid of first column
pga <- pga[, -1]

# Get rid of x_attempts and hole proximity columns
pga <- subset(pga, select = -c(hole_proximity, x_of_attempts))

# Get rid of "T" in masters finish and ranking columns
pga$masters_finish<-gsub("T","",as.character(pga$masters_finish))
pga$ranking<-gsub("T","",as.character(pga$ranking))



# Converting distance columns to inches

pga_mat_fair <- stringr::str_extract_all(pga$prox_fair, "\\d+", simplify = TRUE)
pga$prox_fair <- as.numeric(pga_mat_fair[, 1]) * 12 + as.numeric(pga_mat_fair[, 2])
pga_mat_rough <- stringr::str_extract_all(pga$prox_rough, "\\d+", simplify = TRUE)
pga$prox_rough <- as.numeric(pga_mat_rough[, 1]) * 12 + as.numeric(pga_mat_rough[, 2])
pga_mat_arg <- stringr::str_extract_all(pga$prox_arg, "\\d+", simplify = TRUE)
pga$prox_arg <- as.numeric(pga_mat_arg[, 1]) * 12 + as.numeric(pga_mat_arg[, 2])


# Fill in NA's for score_average column to median
#pga$score_average[is.na(pga$score_average)] <- median(pga$score_average, na.rm = T)


# Get rid of all rows that have "CU" for masters finish column. This indicates
# That the player did not make the cut, if kept in, this would skew the total score column
newPGA <- subset(pga, (pga$masters_finish != "CU"))
newPGA2 <- subset(newPGA, newPGA$masters_finish != "WD")                 


# Change the value in the masters finish column to 1 if "Win"
newPGA2$masters_finish[newPGA2$masters_finish == "Win"] <- 1 

#Get rid of NA's
newPGA2 <- na.omit(newPGA2)

# Drop player name column
newPGA2 <- newPGA2[, -2]


# Cleaned Data-frame to use for testing
#View(newPGA2)

```




This is all the current players stats who have played in 2022 and will be
competing in the masters this year. There is also some players playing that are
not in this list because they are playing in the masters but haven't played in 
2022 season yet[etc.. tiger woods, Bryson Dechambeau]. We are going to predict 
the top 10 players from this dataset.

Players missing from this list:
 - Rory Mcllory *
 - Bryson DeChambeau *
 - Harris English
 - Thomas Pieters *
 - Harold Varner
 - Takumi Kanaya
 - Min Woo Lee 
 - Lee Westwood
 - Bubba Watson *
 - Robert MacIntyre
 - Kyoung-Hoon Lee
 - Guido Migliozzi
 - Padraig Harrington
 - Keita Nakajima
 - Stewart Hagestad
 - Bernhard Langer
 - Aaron Jarvis
 - Larry Mize
 - Laird Shepherd
 - Austin Greaser
 - Jose Maria Olazabal
 - Fred Couples
 - Vijay Singh
 - James Piot
 - Mike Weir
 - Sandy Lyle
 - Tiger Woods *
 
For all the players who haven't played in 2022 we need to find data from the
last year they played.

For all the players who played in 2022 but the scraper did not get their data,
we should manually put it in for predictions. We should find which variables
we are using first, so we do not have to get as much data.




Manually Getting based on the quality of their past year and their participation in the 2022 Masters

 - Rory Mcllory *
 - Bryson DeChambeau *
 - Thomas Pieters *
 - Bubba Watson *
 - Tiger Woods *



All data from 2021 & 2022 pga seasons
```{r}

data <- read.csv("2022FinalMasters_pred_data.csv")
#View(data)

predict_2022_masters <- subset(data, data$player_name %in% masters_list$player_name)
View(predict_2022_masters)

 
data20212022 <- read.csv("masterspred20212022.csv")
#View(data20212022)

```


Clean Masters 2022 Data for prediction
```{r}

# Geting rid of T in front of some ranks
predict_2022_masters$ranking<-gsub("T","",as.character(predict_2022_masters$ranking))

# Get rid of x_attempts and hole proximity column
predict_2022_masters <- subset(predict_2022_masters,
                               select = -c(hole_proximity, x_of_attempts))


# Change columns with ft as units to inches
mat_fair <- stringr::str_extract_all(predict_2022_masters$prox_fair, "\\d+", simplify = TRUE)
predict_2022_masters$prox_fair <- as.numeric(mat_fair[, 1]) * 12 + as.numeric(mat_fair[, 2])
mat_rough <- stringr::str_extract_all(predict_2022_masters$prox_rough, "\\d+", simplify = TRUE)
predict_2022_masters$prox_rough <- as.numeric(mat_rough[, 1]) * 12 + as.numeric(mat_rough[, 2])
mat_arg <- stringr::str_extract_all(predict_2022_masters$prox_arg, "\\d+", simplify = TRUE)
predict_2022_masters$prox_arg <- as.numeric(mat_arg[, 1]) * 12 + as.numeric(mat_arg[, 2])


View(predict_2022_masters)

```


Technique Ideas:

- Logistic Regression to get probability of winning
- linear regression to predict total score for weekend
  - We are going to try to predict the final score response variable. To
  predict for this year, we will pass in all the players data up until the
  tournament.


Create Training/Test Data:
Clean up original data frame with all players from 2005:2019.
  - use that data as test data to predict masters score
create subset of 2021 data
  - Use this as test data to calculate error rate etc....
  


Linear Regression:
```{r}
#Splitting data in training and test data

# Getting all data before 2021 season
data.train <- newPGA2[which(newPGA2$year < 2021),]
data.train$ranking <- as.numeric(as.character(data.train$ranking))
#data.train$masters_finish <- as.numeric(as.character(data.train$masters_finish))
data.train <- subset(data.train, select = -c(masters_finish))
data.train <- data.train[, -1]




# Getting all data from the 2021 season.
data.test <- newPGA2[which(newPGA2$year == 2021),]



# Selecting Model Variables
data.fit <- lm(total_score ~ ., data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10, data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10 - sg_total - , data = data.train)
summary(data.fit)


data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green , data = data.train)
summary(data.fit)


data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save, data = data.train)
summary(data.fit)


data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa, data = data.train)
summary(data.fit)


data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt, data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins, data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins - par3_sa, data = data.train)
summary(data.fit)


data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins - par3_sa - par4_sa, data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins - par3_sa - par4_sa
               - sg_tee, data = data.train)
summary(data.fit)


data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins - par3_sa - par4_sa
               - sg_tee - sg_t2g, data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins - par3_sa - par4_sa
               - sg_tee - sg_t2g - sg_ar, data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins - par3_sa - par4_sa
               - sg_tee - sg_t2g - sg_ar - putt_25, data = data.train)
summary(data.fit)

data.fit <- lm(total_score ~ . -putt_10 - sg_total - go_for_green - sand_save
               - finround_sa - sg_putt - wins - par3_sa - par4_sa
               - sg_tee - sg_t2g - sg_ar - putt_25 - covered_tee, data = data.train)
summary(data.fit)

```



